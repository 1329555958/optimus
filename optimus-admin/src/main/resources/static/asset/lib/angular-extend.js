/*! hx 2016-05-17 13 */
!function(window,angular,undefined){"use strict";function getPageItems(total,current,length){var items=[];if(length>=total)for(var i=1;total>=i;i++)items.push(i);else{var base=0;current-0>Math.floor((length-1)/2)&&(base=Math.min(total,current-0+Math.ceil((length-1)/2))-length);for(var i=1;length>=i;i++)items.push(base+i)}return items}angular.module("ngExtend",["ng"]).provider("$require",function(){this.require=function(deps){return angular.isString(deps)&&(deps=[deps]),["$rootScope","$q",function($rootScope,$q){var def=$q.defer();return require(deps,function(){$rootScope.$apply(function(){def.resolve()})}),def.promise}]},this.$get=function(){return this}}).factory("$myhttp",function($rootScope){function apply(obj){return obj&&obj.responseText&&-1!==obj.responseText.indexOf("理财平台-登录")?void(window.location.href=APPROOT+"/login"):void setTimeout(function(){$rootScope.$apply()},300)}function err(xhr,status,err){var resp=xhr.responseJSON;if("NEED_LOGIN"===resp.status)return void(window.location.href=resp.reason);var msg=resp.reason,reg=new RegExp("[\\u4E00-\\u9FFF]+","g");reg.test(msg)||(msg=resp.exception_id?"错误编号="+resp.exception_id:""),angular.info("操作失败:"+msg),console.error("$myhttp请求出错",xhr,status,err)}function get(){return $.get.apply(window,arguments).complete(apply).error(err)}function post(){return $.post.apply(window,arguments).complete(apply).error(err)}function http(name,obj){function complete(){angular.isString(name)&&(angular.isObject(obj)?_.set(obj,name,!1):$rootScope.$emit("HTTP_EVENT",{name:name,data:"end"})),apply.apply(null,arguments)}return angular.isString(name)&&(angular.isObject(obj)||$rootScope.$emit("HTTP_EVENT",{name:name,data:"start"})),{get:function(){return $.get.apply(window,arguments).complete(complete).error(err)},post:function(){return $.post.apply(window,arguments).complete(complete).error(err)}}}return http.get=get,http.post=post,http}).factory("$rest",function($http){function dealInfData(data){_.each(INF_DATA,function(arr,key){_.each(arr,function(inf,index){INF_INDEX[inf.id]={type:key,index:index}})})}function getInfById(id){if(!INF_INDEX[id])throw new Error("不存在id="+id+"的接口!");var index=INF_INDEX[id],inf=INF_DATA[index.type][index.index];return inf}function successCb(cb){return function(resp){var data=resp.data;return 0!==data.code?(console.warn(data),void alert(data.msg)):void cb(data.data)}}function errCb(resp){console.error(resp),alert("请求出现异常!请稍候重试!")}function get(url,param,cb){var p=$http.get(url,{data:param});return p.then(successCb(cb),errCb),p}var INF_DATA={},INF_INDEX={},PGetInfData=$http.get(angular.CFG.load_interface_url);PGetInfData.then(successCb(function(data){INF_DATA=data,dealInfData(INF_DATA),console.log("接口数据",INF_DATA,INF_INDEX)}),errCb);var rest={};return rest.get=function(id,param,callback,config){return PGetInfData.then(function(){var inf=getInfById(id),param=_.extend({},inf.param,param);get(inf.url,param,callback)})},rest}).directive("myDateTime",function($parse){return{restrict:"AE",replace:!1,link:function(scope,element,attrs,controller){var cfg,$link,opts={format:"YYYY-MM-DD HH:mm:ss",showClose:!0,showTodayButton:!0};attrs.myDateTime&&(cfg=scope.$eval(attrs.myDateTime)),cfg&&cfg.linkSelector&&$(cfg.linkSelector).length&&($link=$(cfg.linkSelector),delete cfg.linkSelector),angular.isObject(cfg)&&$.extend(opts,cfg),element.datetimepicker(opts);var $date=element.data("DateTimePicker"),ngModel=element.find("input").attr("ng-model");if(ngModel){var modelGetter=$parse(ngModel),modelSetter=modelGetter.assign,initDate=modelGetter(scope);initDate&&$date.date(initDate),scope.$watch(ngModel,function(n,o){n&&$date.date(n)});var moment=window.moment||require("moment");element.on("dp.change",function(e){if(modelSetter(scope,e.date?moment(e.date._d).format(opts.format):""),$link){var $dtp=$link.data("DateTimePicker");$dtp.minDate(e.date)}})}}}}).directive("pagination",function(){return{restrict:"E",replace:!0,template:'<div ng-show="totalPage>0" class="dataTables_paginate paging_simple_numbers">                                           <ul class="pagination">                                                               <li class="paginate_button previous " ng-class="{disabled:noPrev()}"><a href="#" ng-click="selectPage(1)"  title="首页">1</a></li>                                    <li class="paginate_button previous " ng-class="{disabled:noPrev()}"><a href="#" ng-click="prev()" title="上一页"><</a></li>                                    <li class="paginate_button" ng-repeat=" page in pages" ng-class="{active:isActive(page)}"><a href="javascript:void(0);" ng-click="selectPage(page)">{{page}}</a></li>     <li class="paginate_button next" ng-class="{disabled:noNext()}"><a href="#" ng-click="next()" title="下一页">></a></li>                                    <li class="paginate_button next" ng-class="{disabled:noNext()}"><a href="#" ng-click="selectPage(totalPage)"  title="尾页">{{totalPage||1}}</a></li>                                  </ul>                                                          </div>                                                           ',scope:{totalPage:"=",currentPage:"=",onSelectPage:"&"},link:function(scope,element,attrs,controller){scope.currentPage=scope.currentPage||1,scope.$watch("currentPage",function(value){scope.pages=getPageItems(scope.totalPage,value,10),scope.currentPage>scope.totalPage&&(scope.currentPage=scope.totalPage)}),scope.$watch("totalPage",function(value){scope.pages=getPageItems(value,scope.currentPage,10),scope.currentPage>value&&(scope.currentPage=value)}),scope.isActive=function(page){return scope.currentPage===page},scope.selectPage=function(page){1>page&&(page=1),page>scope.totalPage&&(page=scope.totalPage),scope.isActive(page)||(scope.currentPage=page,scope.onSelectPage({page:scope.currentPage}))},scope.prev=function(){scope.selectPage(scope.currentPage-1)},scope.next=function(){scope.selectPage(scope.currentPage+1)},scope.noPrev=function(){return!(scope.currentPage>1)},scope.noNext=function(){return!(scope.currentPage<scope.totalPage)}}}})}(window,window.angular);