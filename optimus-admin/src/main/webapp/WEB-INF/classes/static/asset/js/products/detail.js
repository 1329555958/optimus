/*! hx 2016-05-17 13 */
require("app").register.controller("prdDetailController",function($scope,$location,$timeout,$myhttp){var id=$location.search().id;id||angular.alert("缺少产品编号!",function(){window.history.back()});var investPagination=($scope.baseInfo={},$scope.investRecords=[],$scope.repaymentRecords=[],$scope.investPagination={currentPage:1,totalPage:0}),repaymentPagination=$scope.repaymentPagination={currentPage:1,totalPage:0};$scope.repaymentInfo={totalPrincipalAndInterest:0,totalInterest:0},$scope.product={},$scope.noTheProduct=!1,$scope.loading={baseInfo:!1,invest:!1,repayment:!1},$scope.queryBaseInfo=function(){$scope.loading.baseInfo=!0;var param={subjectNo:id};console.log("基本信息请求参数",param),$myhttp("loading.baseInfo",$scope).get("/product/list",param,angular.ajaxIsSuccess(function(result){result.result&&result.result.length?$scope.product=result.result[0]:$scope.noTheProduct=!0}))};var investStatuses=$scope.investStatuses=[{text:"全部",value:"REFUNDING,BID_FAIL,INIT,PAY_SUCCESS,BID_SUCCESS,REFUND_SUCCESS"},{text:"待支付",value:"INIT"},{text:"支付成功",value:"PAY_SUCCESS"},{text:"确认成功",value:"BID_SUCCESS"},{text:"已退款",value:"REFUND_SUCCESS"}];$scope.orderStatus=investStatuses[0].value,$scope.startDate=new Date((new Date).getTime()-2592e6),$scope.endDate=new Date;var moment=require("moment");$scope.queryInvestRecords=function(page){var param={};$scope.loading.invest=!0,param.pageNum=page||1,param.pageSize=10,param.subjectNo=id,param.statusList=$scope.orderStatus,param.startTime=moment($scope.startDate).format("x"),param.endTime=moment($scope.endDate).format("x"),console.info("申购记录请求参数",param),$myhttp("loading.invest",$scope).get("/product/investRecords",param,angular.ajaxIsSuccess(function(result){investPagination.currentPage=result.pageIndex,investPagination.totalPage=result.pageCount,$scope.investRecords=result.result}))},$scope.queryRepaymentRecords=function(page){var param={};$scope.loading.repayment=!0,param.pageNum=page||1,param.pageSize=10,param.subjectNo=id,console.info("还款记录请求参数",param),$myhttp("loading.repayment",$scope).get("/product/repaymentRecords",param,angular.ajaxIsSuccess(function(result){repaymentPagination.currentPage=result.pageIndex,repaymentPagination.totalPage=result.pageCount,$scope.repaymentRecords=result.result,$scope.repaymentInfo=result}))},$timeout(function(){$scope.queryBaseInfo(),$scope.queryInvestRecords(),$scope.queryRepaymentRecords()},300)});